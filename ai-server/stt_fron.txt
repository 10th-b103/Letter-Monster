import axios from "axios";
import React, { useState } from "react";
import {
  ReactMediaRecorder,
  ReactMediaRecorderRenderProps,
} from "react-media-recorder";

const STT: React.FC = () => {
  const [text, setText] = useState<string>("");

  const speechToText = async (audioUrl: string) => {
    try {
      // audio 파일
      const fetchData = await fetch(audioUrl);
      const blobData = await fetchData.blob();
      const formData = new FormData();
      formData.append("audio", blobData, "audio.wav");

      // 언어 선택
      formData.append("lang", "Kor"); // Kor, Jpn, Eng, Chn

      const result = await axios.post(
        "http://localhost:8000/ai/letter/stt",
        formData
      );
      console.log(result);
      setText(result.data.text);
    } catch (err) {
      console.error("Error in speechToText:", err);
    }
  };

  return (
    <div>
      <ReactMediaRecorder
        audio
        render={({
          status,
          startRecording,
          stopRecording,
          mediaBlobUrl,
        }: ReactMediaRecorderRenderProps) => (
          <div>
            <div>상태: {status}</div>
            <button onClick={startRecording}>녹음 시작</button>
            <button onClick={stopRecording}>녹음 중지</button>
            {mediaBlobUrl && (
              <audio src={mediaBlobUrl} controls autoPlay loop />
            )}
            <button onClick={() => mediaBlobUrl && speechToText(mediaBlobUrl)}>
              STT test
            </button>
          </div>
        )}
      />
      {text}
    </div>
  );
};

export default STT;
